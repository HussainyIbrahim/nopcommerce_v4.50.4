@using Nop.Web.Areas.Admin.Models.Product

@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model AddEditProductErrorModel
@{
    //page title
    ViewBag.PageTitle = T("Admin.TroubleShooting.ProductErrors").Text;
    //active menu item (system name)
    NopHtml.SetActiveMenuItemSystemName("TroubleShootingProducts");
}
<div class="content-header clearfix">
    <h1 class="float-left">
        @if (Model.Id == 0)
            @T("Admin.TroubleShooting.ProductErrors.AddNew")
        else
            @T("Admin.TroubleShooting.ProductErrors.Edit")

            <small>
                <i class="fas fa-arrow-circle-left"></i>
                <a asp-action="ProductErrorList" asp-route-id="@Model.ProductId">@T("Admin.TroubleShooting.ProductErrors.BackToList")</a>
            </small>
        </h1>
        <div class="float-right">
            <button type="button" name="save" class="btn btn-primary">
                <i class="far fa-save"></i>
                @T("Admin.Common.Save")
            </button>
        </div>
    </div>
    <section class="content">
        <div class="container-fluid">
            <div class="form-horizontal">
                <div class="form-group row">
                    <div class="col-md-3">
                        <nop-label asp-for="Description" />
                    </div>
                    <div class="col-md-9">
                        <nop-textarea asp-for="Description" asp-required="true"/>
                        <span asp-validation-for="Description"></span>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <nop-label asp-for="SelectedErrorId" />
                    </div>
                    <div class="col-md-9">
                        <nop-select asp-for="SelectedErrorId" asp-items="@Model.ErrorDDL" />
                        <span asp-validation-for="SelectedErrorId"></span>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-3">
                        <nop-label asp-for="SelectedStepId" />
                    </div>
                    <div class="col-md-9">
                        <nop-select asp-for="SelectedStepId" asp-items="@Model.StepDDL" />
                        <span asp-validation-for="SelectedStepId"></span>
                    </div>
                    <div class="form-group row">
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-9">
                            <button id="saveProduct" type="button" class="btn btn-primary">@T("Forum.Submit")</button>
                            <input name="productId" type="hidden" value="@Model.ProductId" />
                            <input name="productErrorId" type="hidden" value="@Model.Id" />
                        </div>
                    </div>
                </div>
            </div>
    </section>
    <script>
        $(document).ready(function () {
            $('[name=save]').click(function () {
                $("#saveProduct").click();
                return false;
            });
            $('#saveProduct').click(function () {
                var postData = {
                    description: $('#@Html.IdFor(model => model.Description)').val(),
                    selectedErrorId: parseInt($('#@Html.IdFor(model => model.SelectedErrorId)').val()),
                    selectedStepId: parseInt($('#@Html.IdFor(model => model.SelectedStepId)').val()),
                    productId: @Model.ProductId,
                    id: @Model.Id
                            };
                addAntiForgeryToken(postData);
                var url = "@Url.Action("CreateProductError", "TroubleShootingProduct")";
                if (parseInt($('[name=productErrorId]').val()) > 0)
                    url = "@Url.Action("EditProductError", "TroubleShootingProduct")";
                $.ajax({
                    cache: false,
                    url: url,
                    type: "POST",
                    data: postData,
                    dataType: "json",
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert(JSON.stringify(jqXHR));
                    },
                    success: function (data, textStatus, jqXHR) {
                        window.location.href = '/Admin/TroubleShootingProduct/ProductErrorList/' + parseInt($('[name=productId]').val());
                    }
                });
            });
        });
    </script>